---
title: "Applied Machine Learning 01 Group Work"
author: "Jonas ZÃ¼rcher, Stephan Wernli, Luca Casuscelli, Dominik Vasquez"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  pdf_document:
    fig_caption: true
    number_sections: true
  html_document: default
theme: united
toc: yes
---

\pagebreak

# Load the libraries and import the dataset
```{r echo=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(e1071)  

house_data <- read_csv("../01_data/house_data.csv")

house_data$object_type_name <- as.factor(house_data$object_type_name)
house_data$num_rooms <- as.integer(house_data$num_rooms)


house_data <- house_data %>% select(object_type_name,
                                    build_year,
                                    living_area,
                                    zipcode,
                                    municipality_name,
                                    num_rooms,
                                    travel_time_private_transport,
                                    travel_time_public_transport,
                                    number_of_buildings_in_hectare,
                                    number_of_apartments_in_hectare,
                                    number_of_workplaces_in_hectare,
                                    population_in_hectare,
                                    water_percentage_1000,
                                    price)
```

\pagebreak

# Description of the used data set

The data set contains the following predictors: 

- object_type_name                    categorical                  
- build_year                          continues
- living_area                         continues
- zipcode                             categorical
- municipality_name                   categorical
- num_rooms                           count data/categorical
- travel_time_private_transport       continues
- travel_time_public_transport        continues 
- number_of_buildings_in_hectare      count data
- number_of_apartments_in_hectare     count data
- number_of_workplaces_in_hectare     count data
- population_in_hectare               count data
- water_percentage_1000               count data
- price                               continues

\pagebreak

# Graphical interpretation and simple linear modeling
```{r}

library(ggplot2)
qplot(y = price, x = build_year,data = house_data,facets = ~ object_type_name)

ggplot(house_data, aes(x=object_type_name, y=price)) +
geom_boxplot()
```

\pagebreak

# RegressionSplines

```{r}
library(splines)
lm.regressionSplines <- lm(price ~ bs(living_area, df = 3), data = house_data)
summary(lm.regressionSplines)
plot(lm.regressionSplines)
```

\pagebreak

# Generalised Additiv Models

```{r}
library(splines)
lm.regressionSplines <- lm(price ~ bs(living_area, df = 3), data = house_data)
summary(lm.regressionSplines)
plot(lm.regressionSplines)
```

\pagebreak

# Generalised linear models

```{r}

```

\pagebreak

# Tree's

```{r}
library(ISLR)
library(tree)

wine_tree <-  tree(price ~ . ,data = house_data)

summary(wine_tree)

plot(wine_tree)
text(wine_tree, all=TRUE, cex=.8)

```

\pagebreak

# Support vector machines

```{r eval=FALSE, include=FALSE}

#To Do separation still not working right 
house_data <- house_data %>% filter(object_type_name ==  "Einfamilienhaus"  | object_type_name ==  "Wohnung")
house_data <- house_data %>%  droplevels()
house_data$object_type_name %>%  unique()

## 75% of the sample size
smp_size <- floor(0.75 * nrow(house_data))

## set the seed to make your partition reproducible
set.seed(1)
train_ind <- sample(seq_len(nrow(house_data)), size = smp_size)
house_train <- house_data[train_ind, ]
house_test <- house_data[-train_ind, ]


ggplot(house_data, aes(x=living_area, y=log(price))) + geom_point()


number_of_observations <- 2000
cost_range <- c(0.000005, 0.005,0.1,1,10,100,1000,10000)
svm.models <- tune(
  svm,
  object_type_name ~ price + living_area + num_rooms,
  data = house_train %>% top_n(number_of_observations),
  kernel = "linear",
  ranges = list(cost = cost_range),
  scale = TRUE)
svm.models <- svm.models$best.model
summary(svm.models)


plot(x = svm.models, data = house_train %>% top_n(number_of_observations), formula = price ~ living_area)
plot(x = svm.models, data = house_train %>% top_n(number_of_observations), formula = price ~ num_rooms)
table(predict = predict(svm.models, house_train),truth = house_train$object_type_name)


number_of_observations <- 2000
cost_range <- c(0.000005, 0.005,0.1,1,10,100,1000,10000)
svm.models <- tune(
  svm,
  object_type_name ~ price + living_area + num_rooms,
  data = house_train %>% top_n(number_of_observations),
  kernel = "sigmoid",
  ranges = list(cost = cost_range),
  scale = TRUE)
svm.models <- svm.models$best.model
summary(svm.models)


plot(x = svm.models, data = house_train %>% top_n(number_of_observations), formula = price ~ living_area)
plot(x = svm.models, data = house_train %>% top_n(number_of_observations), formula = price ~ num_rooms)
table(predict = predict(svm.models, house_train),truth = house_train$object_type_name)



number_of_observations <- 2000
cost_range <- c(0.000005, 0.005,0.1,1,10,100,1000,10000)
svm.models <- tune(
  svm,
  object_type_name ~ price + living_area + num_rooms,
  data = house_train %>% top_n(number_of_observations),
  kernel = "radial",
  ranges = list(cost = cost_range),
  scale = TRUE)
svm.models <- svm.models$best.model
summary(svm.models)


plot(x = svm.models, data = house_train %>% top_n(number_of_observations), formula = price ~ living_area)
plot(x = svm.models, data = house_train %>% top_n(number_of_observations), formula = price ~ num_rooms)
table(predict = predict(svm.models, house_train),truth = house_train$object_type_name)
```

\pagebreak
