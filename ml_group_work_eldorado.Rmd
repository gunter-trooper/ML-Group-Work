---
title: "Applied Maschine Learning 01 Group Work"
author: "Stephan Wernli, Jonas ZÃ¼rcher"
date: "13 April 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
rstudioapi::getActiveDocumentContext

library(tidyverse)
library(e1071)  

house_data <- read_csv("C:/github/ML-Group-Work/Machine-learning-databases/house_data.csv")

house_data$object_type_name <- as.factor(house_data$object_type_name)
house_data$num_rooms <- as.integer(house_data$num_rooms)


house_data <- house_data %>% select(object_type_name,
                                    build_year,
                                    living_area,
                                    num_rooms,
                                    travel_time_private_transport,
                                    travel_time_public_transport,
                                    number_of_buildings_in_hectare,
                                    number_of_apartments_in_hectare,
                                    number_of_workplaces_in_hectare,
                                    population_in_hectare,
                                    price)

```


### Description of the used data set

The data set contains the following predictors: 

- object_type_name                    categorical                  
- build_year                          continues
- living_area                         continues
- num_rooms                           count data
- travel_time_private_transport       continues
- travel_time_public_transport        continues 
- number_of_buildings_in_hectare      count data
- number_of_apartments_in_hectare     count data
- number_of_workplaces_in_hectare     count data
- population_in_hectare               count data
- price                               continues


### Graphical interpretation and simple linear modeling


```{r 1}

library(ggplot2)
qplot(y = price, x = build_year,data = house_data,facets = ~ object_type_name)

ggplot(house_data, aes(x=object_type_name, y=price)) +
geom_boxplot()
```


### RegressionSplines

The data set contains the following predictors: 



```{r 2}
library(splines)
lm.regressionSplines <- lm(price ~ bs(living_area, df = 3), data = house_data)
summary(lm.regressionSplines)
plot(lm.regressionSplines)
```

### Generalised Additiv Models


```{r gam}
library(mgcv)

gam.1 <- gam(price ~ s(living_area) +  s(travel_time_private_transport) + s(travel_time_public_transport) + object_type_name + num_rooms, data = house_data)
summary(gam.1)

plot(gam.1, residuals = TRUE, cex = 2)
```

### Generalised linear models

```{r glm}
library(mgcv)

gam.1 <- gam(price ~ s(living_area) +  s(travel_time_private_transport) + s(travel_time_public_transport) + object_type_name + num_rooms, data = house_data)
summary(gam.1)

plot(gam.1)
```






### Tree's


```{r wine4}
library(ISLR)
library(tree)

wine_tree <-  tree(price ~ . ,data = house_data)

summary(wine_tree)

plot(wine_tree)
text(wine_tree, all=TRUE, cex=.8)

```



### Support vector maschines 

```{r SVM1}


#To Do separation still not working right 
house_data <- house_data %>% filter(object_type_name ==  "Einfamilienhaus"  | object_type_name ==  "Wohnung")
house_data <- house_data %>%  droplevels()
house_data$object_type_name %>%  unique()

## 75% of the sample size
smp_size <- floor(0.5 * nrow(house_data))

## set the seed to make your partition reproducible
set.seed(123)
train_ind <- sample(seq_len(nrow(house_data)), size = smp_size)

house_train <- house_data[train_ind, ]
house_test <- house_data[-train_ind, ]






ggplot(house_data, aes(x=living_area, y=log(price))) + geom_point()


number_of_observations <- 5000


cost_range <- c(0.000005, 0.005,0.1,1,10,100,1000,10000)

svm.models <- tune(
  svm,
  object_type_name ~ price + living_area + num_rooms,
  data = house_train %>% top_n(number_of_observations),
  kernel = "radial",
  ranges = list(cost = cost_range),
  scale = TRUE)

svm.models <- svm.models$best.model

summary(svm.models)

plot(x = svm.models, data = house_train %>% top_n(number_of_observations), formula = price ~ living_area)
plot(x = svm.models, data = house_train %>% top_n(number_of_observations), formula = price ~ num_rooms)

table(predict = predict(svm.models, house_train),truth = house_train$object_type_name)

```


